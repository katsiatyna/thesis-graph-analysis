import numpy as np
import statsmodels.api as sm
from matplotlib import pylab as plt
import matplotlib.pyplot as pyplot
import peakutils


def func(x, return_val):
    return return_val

ds = sorted(map(float, [80407479,50425934,82653054,132506654,132512574,8137459,8137565,55013506,21479214,41670179,43294258,45820099,
                 45864568,45880888,47120476,104483915,41745869,32087843,85867303,86386946,7537761,59316711,71262976,55866224,
                 185147302,234917206,234917491,24489763,24755242,30971243,39867712,39883066,11421883,11836267,29602419,115902151,
                 116239951,119250739,121536351,121536416,112891331,170706563,47174222,111733407,4188644,4357547,36146852,
                 57974035,61873557,62262194,66027930,83251943,141212309,25319512,26175897,26179530,26180930,32931461,41833641,
                 100418583,120152091,71813442,71813782,58109172,80410698,50429962,82655509,53374859,134457664,124070384,
                        124070269,4344156,16887282,41707033,10089846,41686214,68397217,12626390,42584288,104485559,41748503,
                        28193653,86711648,87254181,8091000,59368935,41709592,16764011,185149442,42851895,42870301,24776966,28210105,
                        30996135,42872048,42871868,193409197,194134696,86761278,144636867,118612945,151685509,144990021,
                        144990143,112893006,170708906,47199123,111964714,4266657,4360229,36189429,57975730,61875756,62265611,
                        91154657,83253194,141224270,32935734,32930323,32929935,32934432,32934337,42831908,100420068,120155220,
                        89952391,89952299,58110742]))

dens = sm.nonparametric.KDEUnivariate(ds)
dens.fit(bw = 1100000.0)
indexes = peakutils.indexes(dens.density, thres=0.0, min_dist=0)
x_plot_y = []
for x in ds:
    x_plot_y.append(func(ds, 0))
#plt.plot(ds, est(ds), label='Estimate (bw={:.3g})'.format(est.bandwidth))
fig, ax = plt.subplots(nrows=1, ncols=1, sharex=False, sharey=False, squeeze=True,
             subplot_kw=None, gridspec_kw=None, figsize=(18, 5))
ax.plot( dens.density , '-bh', markevery=indexes)
#ax.plot(ds, x_plot_y, '+k')
pyplot.legend(loc='best')
pyplot.title('Density Peaks. NmbPeaks = ' + str(len(indexes)))
pyplot.show()
